<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en"><head>

<meta charset="utf-8">
<meta name="generator" content="quarto-1.2.475">

<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes">

<meta name="author" content="Dr Jackson Stockbridge">
<meta name="dcterms.date" content="2023-06-03">

<title>Geospatial Community - Extracting spatial data from web map servers in R</title>
<style>
code{white-space: pre-wrap;}
span.smallcaps{font-variant: small-caps;}
div.columns{display: flex; gap: min(4vw, 1.5em);}
div.column{flex: auto; overflow-x: auto;}
div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
ul.task-list{list-style: none;}
ul.task-list li input[type="checkbox"] {
  width: 0.8em;
  margin: 0 0.8em 0.2em -1.6em;
  vertical-align: middle;
}
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { display: inline-block; line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
    color: #aaaaaa;
  }
pre.numberSource { margin-left: 3em; border-left: 1px solid #aaaaaa;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
code span.al { color: #ff0000; font-weight: bold; } /* Alert */
code span.an { color: #60a0b0; font-weight: bold; font-style: italic; } /* Annotation */
code span.at { color: #7d9029; } /* Attribute */
code span.bn { color: #40a070; } /* BaseN */
code span.bu { color: #008000; } /* BuiltIn */
code span.cf { color: #007020; font-weight: bold; } /* ControlFlow */
code span.ch { color: #4070a0; } /* Char */
code span.cn { color: #880000; } /* Constant */
code span.co { color: #60a0b0; font-style: italic; } /* Comment */
code span.cv { color: #60a0b0; font-weight: bold; font-style: italic; } /* CommentVar */
code span.do { color: #ba2121; font-style: italic; } /* Documentation */
code span.dt { color: #902000; } /* DataType */
code span.dv { color: #40a070; } /* DecVal */
code span.er { color: #ff0000; font-weight: bold; } /* Error */
code span.ex { } /* Extension */
code span.fl { color: #40a070; } /* Float */
code span.fu { color: #06287e; } /* Function */
code span.im { color: #008000; font-weight: bold; } /* Import */
code span.in { color: #60a0b0; font-weight: bold; font-style: italic; } /* Information */
code span.kw { color: #007020; font-weight: bold; } /* Keyword */
code span.op { color: #666666; } /* Operator */
code span.ot { color: #007020; } /* Other */
code span.pp { color: #bc7a00; } /* Preprocessor */
code span.sc { color: #4070a0; } /* SpecialChar */
code span.ss { color: #bb6688; } /* SpecialString */
code span.st { color: #4070a0; } /* String */
code span.va { color: #19177c; } /* Variable */
code span.vs { color: #4070a0; } /* VerbatimString */
code span.wa { color: #60a0b0; font-weight: bold; font-style: italic; } /* Warning */
</style>


<script src="../../site_libs/quarto-nav/quarto-nav.js"></script>
<script src="../../site_libs/quarto-nav/headroom.min.js"></script>
<script src="../../site_libs/clipboard/clipboard.min.js"></script>
<script src="../../site_libs/quarto-search/autocomplete.umd.js"></script>
<script src="../../site_libs/quarto-search/fuse.min.js"></script>
<script src="../../site_libs/quarto-search/quarto-search.js"></script>
<meta name="quarto:offset" content="../../">
<link href="../../turkeypin.svg" rel="icon" type="image/svg+xml">
<script src="../../site_libs/quarto-html/quarto.js"></script>
<script src="../../site_libs/quarto-html/popper.min.js"></script>
<script src="../../site_libs/quarto-html/tippy.umd.min.js"></script>
<script src="../../site_libs/quarto-html/anchor.min.js"></script>
<link href="../../site_libs/quarto-html/tippy.css" rel="stylesheet">
<link href="../../site_libs/quarto-html/quarto-syntax-highlighting.css" rel="stylesheet" class="quarto-color-scheme" id="quarto-text-highlighting-styles">
<link href="../../site_libs/quarto-html/quarto-syntax-highlighting-dark.css" rel="prefetch" class="quarto-color-scheme quarto-color-alternate" id="quarto-text-highlighting-styles">
<script src="../../site_libs/bootstrap/bootstrap.min.js"></script>
<link href="../../site_libs/bootstrap/bootstrap-icons.css" rel="stylesheet">
<link href="../../site_libs/bootstrap/bootstrap.min.css" rel="stylesheet" class="quarto-color-scheme" id="quarto-bootstrap" data-mode="light">
<link href="../../site_libs/bootstrap/bootstrap-dark.min.css" rel="prefetch" class="quarto-color-scheme quarto-color-alternate" id="quarto-bootstrap" data-mode="dark">
<script id="quarto-search-options" type="application/json">{
  "location": "navbar",
  "copy-button": false,
  "collapse-after": 3,
  "panel-placement": "end",
  "type": "overlay",
  "limit": 20,
  "language": {
    "search-no-results-text": "No results",
    "search-matching-documents-text": "matching documents",
    "search-copy-link-title": "Copy link to search",
    "search-hide-matches-text": "Hide additional matches",
    "search-more-match-text": "more match in this document",
    "search-more-matches-text": "more matches in this document",
    "search-clear-button-title": "Clear",
    "search-detached-cancel-button-title": "Cancel",
    "search-submit-button-title": "Submit"
  }
}</script>


<link rel="stylesheet" href="../../styles.css">
</head>

<body class="floating nav-fixed">

<div id="quarto-search-results"></div>
  <header id="quarto-header" class="headroom fixed-top">
    <nav class="navbar navbar-expand-lg navbar-dark ">
      <div class="navbar-container container-fluid">
      <div class="navbar-brand-container">
    <a class="navbar-brand" href="../../index.html">
    <span class="navbar-title">Geospatial Community</span>
    </a>
  </div>
          <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarCollapse" aria-controls="navbarCollapse" aria-expanded="false" aria-label="Toggle navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">
  <span class="navbar-toggler-icon"></span>
</button>
          <div class="collapse navbar-collapse" id="navbarCollapse">
            <ul class="navbar-nav navbar-nav-scroll ms-auto">
  <li class="nav-item">
    <a class="nav-link" href="../../about.html">
 <span class="menu-text">About</span></a>
  </li>  
  <li class="nav-item">
    <a class="nav-link" href="../../workshops.html">
 <span class="menu-text">Workshops</span></a>
  </li>  
  <li class="nav-item compact">
    <a class="nav-link" href="https://github.com/geocommunity/geocommunity_blog"><i class="bi bi-github" role="img">
</i> 
 <span class="menu-text"></span></a>
  </li>  
</ul>
              <div class="quarto-toggle-container">
                  <a href="" class="quarto-color-scheme-toggle nav-link" onclick="window.quartoToggleColorScheme(); return false;" title="Toggle dark mode"><i class="bi"></i></a>
              </div>
              <div id="quarto-search" class="" title="Search"></div>
          </div> <!-- /navcollapse -->
      </div> <!-- /container-fluid -->
    </nav>
</header>
<!-- content -->
<header id="title-block-header" class="quarto-title-block default toc-left page-columns page-full">
  <div class="quarto-title-banner page-columns page-full">
    <div class="quarto-title column-body">
      <h1 class="title">Extracting spatial data from web map servers in R</h1>
                                <div class="quarto-categories">
                <div class="quarto-category">blog</div>
                <div class="quarto-category">tutorial</div>
                <div class="quarto-category">R</div>
              </div>
                  </div>
  </div>
    
  
  <div class="quarto-title-meta">

      <div>
      <div class="quarto-title-meta-heading">Author</div>
      <div class="quarto-title-meta-contents">
               <p>Dr Jackson Stockbridge </p>
            </div>
    </div>
      
      <div>
      <div class="quarto-title-meta-heading">Published</div>
      <div class="quarto-title-meta-contents">
        <p class="date">June 3, 2023</p>
      </div>
    </div>
    
      
    </div>
    
  
  </header><div id="quarto-content" class="quarto-container page-columns page-rows-contents page-layout-article page-navbar">
<!-- sidebar -->
  <nav id="quarto-sidebar" class="sidebar collapse sidebar-navigation floating overflow-auto">
    <nav id="TOC" role="doc-toc" class="toc-active">
    <h2 id="toc-title">Table of contents</h2>
   
  <ul>
  <li><a href="#the-problem" id="toc-the-problem" class="nav-link active" data-scroll-target="#the-problem">The problem</a></li>
  <li><a href="#code" id="toc-code" class="nav-link" data-scroll-target="#code">Code</a></li>
  </ul>
</nav>
</nav>
<!-- margin-sidebar -->
    <div id="quarto-margin-sidebar" class="sidebar margin-sidebar">
    </div>
<!-- main -->
<main class="content quarto-banner-title-block" id="quarto-document-content">




<section id="what-youll-learn-in-these-notes" class="level4">
<h4 class="anchored" data-anchor-id="what-youll-learn-in-these-notes">What you’ll learn in these notes</h4>
<ol type="1">
<li>What does spatial data on a web map server (WMS) look like?</li>
<li>How to use R to access these data</li>
<li>Convert WMS data in a simple features (sf) object</li>
<li>A broad overview of the capabilities of importing WMS data into R</li>
</ol>
</section>
<section id="the-problem" class="level2">
<h2 class="anchored" data-anchor-id="the-problem">The problem</h2>
<p>I have recently embarked on a mission to collate a spatial database on environmental features and pressures that will eventually feed into a project aiming to develop marine spatial planning frameworks. I love working with data, so the idea of going out and finding as much as I could to work with in R was exciting (I appreciate that there are few people that would share this excitement).</p>
<p>Soon into my mission, I was provided a report that was seemingly a gold mine of different, and relevant datasets. However, I quickly stumbled upon a problem I did not foresee. I was directed to a link leading to an interactive map server, and the data I was after were displayed beautifully online (Fig. 1). I figured it would be a simple case of clicking another link to download the data behind this map, but for the life of me, I could not find this link.</p>
<div class="quarto-figure quarto-figure-left">
<figure class="figure">
<p><img src="fig1.png" class="img-fluid figure-img"></p>
<p></p><figcaption class="figure-caption"><em><strong>Fig. 1.</strong> A screenshot of the data I was trying to access displayed on a web map server. Looks great, how do I access it myself!?</em></figcaption><p></p>
</figure>
</div>
<p>As with most of the issues I come across with data (or just with life in general) I figured that R would have a solution. And it did! Here, I will provide a brief overview of how I managed to get the data from the web map server (WMS) into the wonderfully friendly and versatile ‘sf’ format in R.</p>
<p>Before getting into the code, I want to acknowledge that the solution and code provided here originally accessed from a very helpful blog post by Thierry Onkelinx. I will post the link to the tutorial below, along with a link to their github page, which is full of useful blogs, codes, and functions.</p>
<p><a href="https://inbo.github.io/tutorials/tutorials/spatial_wfs_services/"><strong>Tutorial</strong></a></p>
<p><a href="https://inbo.github.io/tutorials/authors/thierryo/"><strong>Github page</strong></a></p>
<p>I should also state that the tutorial by Thierry provides more details on the capabilities of this code and the objects it creates, as well as what the functions are doing ‘behind the scenes’. The code provided here will just scratch the surface, and provide a way to read the WMS data into R as an ‘sf’ object.</p>
<p>If you have not come across a data link that leads to a WMS, an example is provided below. This <a href="https://www.cmar.csiro.au/geoserver/nerp/wms?service=WMS&amp;version=1.1.0&amp;request=GetMap&amp;layers=nerp:ausrep_shipping_1999&amp;styles=&amp;bbox=105.0,-49.0,165.0,-5.0&amp;width=768&amp;height=563&amp;srs=EPSG:4326&amp;format=application/openlayers">link</a> will display a summary of Australian shipping activity during 1999.</p>
</section>
<section id="code" class="level2">
<h2 class="anchored" data-anchor-id="code">Code</h2>
<p>Disclaimer: These notes assume a basic understanding of how to use R and working with spatial data as ‘sf’ objects.</p>
<p>Install <a href="https://www.r-project.org/">R</a> and <a href="https://www.rstudio.com/products/rstudio/download/">RStudio</a></p>
<p>So, you have followed a link (like the example above) and found yourself looking at the data you want on a WMS. Lets head over to R to start the process of extracting the data.</p>
<p>Install and load the following packages:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb1"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb1-1"><a href="#cb1-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Load packages</span></span>
<span id="cb1-2"><a href="#cb1-2" aria-hidden="true" tabindex="-1"></a><span class="co">#install.packages('tidyverse', 'sf', 'httr', 'ows4R')</span></span>
<span id="cb1-3"><a href="#cb1-3" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(tidyverse)</span>
<span id="cb1-4"><a href="#cb1-4" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(sf)</span>
<span id="cb1-5"><a href="#cb1-5" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(httr)</span>
<span id="cb1-6"><a href="#cb1-6" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(ows4R)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>There is an important part of the link provided that R will use to request the data. This is <u><strong>bold and underlined</strong></u> in our example link below:</p>
<p><u><strong>https://www.cmar.csiro.au/geoserver/nerp/wms?</strong></u>service=WMS&amp;version=1.1.0&amp;request=GetMap&amp;layers=nerp:ausrep_shipping_1999&amp;styles=&amp;bbox=105.0,-49.0,165.0,-5.0&amp;width=768&amp;height=563&amp;srs=EPSG:4326&amp;format=application/openlayers</p>
<p>Lets copy this section of the link into our R script and save it into our global environment. <strong>IMPORTANTLY</strong>, we need to change ‘wms’ to ‘wfs’ in the link.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb2"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb2-1"><a href="#cb2-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Save URL</span></span>
<span id="cb2-2"><a href="#cb2-2" aria-hidden="true" tabindex="-1"></a>wfs_url <span class="ot">&lt;-</span> <span class="st">'https://www.cmar.csiro.au/geoserver/nerp/wfs?'</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>I will humbly admit that the nuts and bolts of WMS and web features servers (WFS) are beyond my understanding. I like to think of it as WMS refers to the finished map product, and WFS to the meta data behind the map. WFS seems to be more versatile and useful than WMS when it comes to using these in R.</p>
<p>Next, we use the ‘parse’ function to convert the URL into a list, allowing us (and R) to do more useful things with it.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb3"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb3-1"><a href="#cb3-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Make URL R-friendly</span></span>
<span id="cb3-2"><a href="#cb3-2" aria-hidden="true" tabindex="-1"></a>url <span class="ot">&lt;-</span> <span class="fu">parse_url</span>(wfs_url)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>We now need to generate a connection that will allow R to talk to the server.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb4"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb4-1"><a href="#cb4-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Generate connection to server</span></span>
<span id="cb4-2"><a href="#cb4-2" aria-hidden="true" tabindex="-1"></a>url_client <span class="ot">&lt;-</span> WFSClient<span class="sc">$</span><span class="fu">new</span>(wfs_url, <span class="at">serviceVersion =</span> <span class="st">"2.0.0"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>This will add ‘url_client’ into the global environment as an R6 object (or ‘environment’). Don’t worry if this seems new or strange, this is another example of something that I do not fully understand. However, it does allow us to get a closer look at the capabilities of bringing WMS data into R. By viewing this object (using ‘View’), we can dive into its many layers and see what is at our fingertips!</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb5"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb5-1"><a href="#cb5-1" aria-hidden="true" tabindex="-1"></a><span class="co">#View(url_client)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>We can also use the following function to explore the operations that provide us with more information on our data.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb6"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb6-1"><a href="#cb6-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Explore operations</span></span>
<span id="cb6-2"><a href="#cb6-2" aria-hidden="true" tabindex="-1"></a>url_client<span class="sc">$</span></span>
<span id="cb6-3"><a href="#cb6-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">getCapabilities</span>()<span class="sc">$</span></span>
<span id="cb6-4"><a href="#cb6-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">getOperationsMetadata</span>()<span class="sc">$</span></span>
<span id="cb6-5"><a href="#cb6-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">getOperations</span>() <span class="sc">%&gt;%</span></span>
<span id="cb6-6"><a href="#cb6-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">map_chr</span>(<span class="cf">function</span>(x){x<span class="sc">$</span><span class="fu">getName</span>()})</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code> [1] "GetCapabilities"       "DescribeFeatureType"   "GetFeature"           
 [4] "GetPropertyValue"      "ListStoredQueries"     "DescribeStoredQueries"
 [7] "CreateStoredQuery"     "DropStoredQuery"       "LockFeature"          
[10] "GetFeatureWithLock"    "Transaction"          </code></pre>
</div>
</div>
<p>Someone with advanced knowledge and experience with R will be able to use these to truly get the most out of the WMS data. However, this is beyond the scope of this blog, and we will just focus on getting the spatial data into an ‘sf’ object.</p>
<p>In saying that, we will get a taste of the capabilities using the following function, which will allow us to look at the data layers that we are able to extract.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb8"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb8-1"><a href="#cb8-1" aria-hidden="true" tabindex="-1"></a><span class="co"># See layer names</span></span>
<span id="cb8-2"><a href="#cb8-2" aria-hidden="true" tabindex="-1"></a>url_client<span class="sc">$</span><span class="fu">getFeatureTypes</span>() <span class="sc">%&gt;%</span></span>
<span id="cb8-3"><a href="#cb8-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">map_chr</span>(<span class="cf">function</span>(x){x<span class="sc">$</span><span class="fu">getName</span>()})</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>  [1] "nerp:1996-2000-Data_All_SeismicSurveys__2D_2013_09" 
  [2] "nerp:2001-2005-Data_All_SeismicSurveys__2D_2013_09" 
  [3] "nerp:2006-2010-Data_All_SeismicSurveys__2D_2013_09" 
  [4] "nerp:seismic2d_sum_1961to1965"                      
  [5] "nerp:seismic2d_sum_1966to1970"                      
  [6] "nerp:seismic2d_sum_1971to1975"                      
  [7] "nerp:seismic2d_sum_1976to1980"                      
  [8] "nerp:seismic2d_sum_1981to1985"                      
  [9] "nerp:seismic2d_sum_1986to1990"                      
 [10] "nerp:seismic2d_sum_1991to1995"                      
 [11] "nerp:seismic2d_sum_1996to2000"                      
 [12] "nerp:seismic2d_sum_2001to2005"                      
 [13] "nerp:seismic2d_sum_2006to2010"                      
 [14] "nerp:37005002_Broadnosesevengill-clip"              
 [15] "nerp:37013003_spottedwobb"                          
 [16] "nerp:37013020_gulfwobbe"                            
 [17] "nerp:37015001_draughtboard-clip"                    
 [18] "nerp:37015009_sawtailcatshark"                      
 [19] "nerp:37015013_whitefin_swellshark"                  
 [20] "nerp:37017003_whiskery-clip"                        
 [21] "nerp:37017008_schoolshark"                          
 [22] "nerp:37018001_bronze-clip"                          
 [23] "nerp:37018003_dusky"                                
 [24] "nerp:37020003_Brier_Shark"                          
 [25] "nerp:37020005_blackbellylantern"                    
 [26] "nerp:37020006_pikedspurdog-clip"                    
 [27] "nerp:37020048_greeneyespurdog"                      
 [28] "nerp:37023002_commonsawshark-clip"                  
 [29] "nerp:37024001_australianangelshark"                 
 [30] "nerp:37024002_ornateangelshark"                     
 [31] "nerp:37027011_southernFidlerRay"                    
 [32] "nerp:37031007_thornbackskate-clip"                  
 [33] "nerp:37031009_peacockskate"                         
 [34] "nerp:37031010_bightskate"                           
 [35] "nerp:37031028_greyskate"                            
 [36] "nerp:37035001_shorttailsting-clip"                  
 [37] "nerp:37035002_blacksting"                           
 [38] "nerp:37039001_southerneagleRay-clip"                
 [39] "nerp:37042001_ogilbysghostshark"                    
 [40] "nerp:37042003_blackfinGhostshark"                   
 [41] "nerp:37042005_SouthernChimaera"                     
 [42] "nerp:37043001_ElephantFish-clip"                    
 [43] "nerp:seismic3d_sum_1976to1980"                      
 [44] "nerp:seismic3d_sum_1981to1985"                      
 [45] "nerp:seismic3d_sum_1986to1990"                      
 [46] "nerp:seismic3d_sum_1991to1995"                      
 [47] "nerp:seismic3d_sum_1996to2000"                      
 [48] "nerp:seismic3d_sum_2001to2005"                      
 [49] "nerp:seismic3d_sum_2006to2010"                      
 [50] "nerp:ais_shipping_2013"                             
 [51] "nerp:ais_shipping_2014"                             
 [52] "nerp:ais_shipping_2015"                             
 [53] "nerp:AMSA-spills-Chemical-2009-2013"                
 [54] "nerp:AMSA-spills-Garbage-2009-2013"                 
 [55] "nerp:AMSA-spills-Oil-2009-2013"                     
 [56] "nerp:AMSA-spills-OtherSubstances"                   
 [57] "nerp:AMSA-spills_HarmfulSubstances-2009-2013"       
 [58] "nerp:ausrep_shipping_1999"                          
 [59] "nerp:ausrep_shipping_2000"                          
 [60] "nerp:ausrep_shipping_2001"                          
 [61] "nerp:ausrep_shipping_2002"                          
 [62] "nerp:ausrep_shipping_2003"                          
 [63] "nerp:ausrep_shipping_2004"                          
 [64] "nerp:ausrep_shipping_2005"                          
 [65] "nerp:ausrep_shipping_2006"                          
 [66] "nerp:ausrep_shipping_2007"                          
 [67] "nerp:ausrep_shipping_2008"                          
 [68] "nerp:ausrep_shipping_2009"                          
 [69] "nerp:ausrep_shipping_2010"                          
 [70] "nerp:ausrep_shipping_2011"                          
 [71] "nerp:csq_al_20112014"                               
 [72] "nerp:al_2013070120180631"                           
 [73] "nerp:bsczsf_2013070120180631"                       
 [74] "nerp:csq_ds_20112014"                               
 [75] "nerp:ds_2013070120180631"                           
 [76] "nerp:csq_bl_20112014"                               
 [77] "nerp:bl_2013070120180631"                           
 [78] "nerp:tw_2013070120180631"                           
 [79] "nerp:dugong_broadscale"                             
 [80] "nerp:dugong_finescale"                              
 [81] "nerp:humpbacks_gbr"                                 
 [82] "nerp:Fish-csq_gn_20112014"                          
 [83] "nerp:gn_2013070120180631"                           
 [84] "nerp:greenturtles"                                  
 [85] "nerp:csq_hl_20112014"                               
 [86] "nerp:hl_2013070120180631"                           
 [87] "nerp:wahumpbackdistbroadscale"                      
 [88] "nerp:j_2013070120180631"                            
 [89] "nerp:llp_2013070120180631"                          
 [90] "nerp:mid_2013070120180631"                          
 [91] "nerp:oil_spills_sum"                                
 [92] "nerp:oil_lease_areas"                               
 [93] "nerp:cables_active_hydro_proj"                      
 [94] "nerp:cables_deco_hydro_proj"                        
 [95] "nerp:updatedpetroleumpipelines"                     
 [96] "nerp:wells_oil_gas"                                 
 [97] "nerp:csq_llp_20112014"                              
 [98] "nerp:csq_pl_20112014"                               
 [99] "nerp:pb_2013070120180631"                           
[100] "nerp:1991_enumeration_proj"                         
[101] "nerp:1996_enumeration_proj"                         
[102] "nerp:2001_enumeration_proj"                         
[103] "nerp:2006_enumeration_proj"                         
[104] "nerp:2011_enumeration_proj"                         
[105] "nerp:Pre-1996-Data_All_SeismicSurveys__2D_2013_09"  
[106] "nerp:csq_ps_20112014"                               
[107] "nerp:ps_2013070120180631"                           
[108] "nerp:sa_handline_msf_2006_2010"                     
[109] "nerp:sa_line_msf_2006_2010"                         
[110] "nerp:sa_line_msf_2011_2015"                         
[111] "nerp:sa_nets_msf_2006_2010"                         
[112] "nerp:sa_nets_msf_2011_2015"                         
[113] "nerp:sa_prawn_2006_2010"                            
[114] "nerp:sa_prawn_2011_2015"                            
[115] "nerp:sa_rl_2006_2010"                               
[116] "nerp:sa_rl_2011_2015"                               
[117] "nerp:sa_sardine_2006_2010"                          
[118] "nerp:sa_sardine_2011_2015"                          
[119] "nerp:sa_traps_msf_2006_2010"                        
[120] "nerp:sa_traps_msf_2011_2015"                        
[121] "nerp:sa_abalone_2011_2015"                          
[122] "nerp:sa_handline_msf_2011_2015"                     
[123] "nerp:sa_othergear_msf_2006_2010"                    
[124] "nerp:sa_othergear_msf_2011_2015"                    
[125] "nerp:sa_abalone_2006_2010"                          
[126] "nerp:seagrass_aggregations"                         
[127] "nerp:srw_agregations"                               
[128] "nerp:srw_aggregations_finescale"                    
[129] "nerp:srw_range_broadscale"                          
[130] "nerp:spermwhale_aggregations_finescale"             
[131] "nerp:spermwhale_aggregations_totals"                
[132] "nerp:spermwhale_core_broadscale"                    
[133] "nerp:TASEffort_DS"                                  
[134] "nerp:TASEffort_GNMN"                                
[135] "nerp:TASEffort_HG"                                  
[136] "nerp:TASEffort_DN"                                  
[137] "nerp:TASEffort_HL"                                  
[138] "nerp:TASEffort_JIG"                                 
[139] "nerp:TASEffort_LLDL"                                
[140] "nerp:TASEffort_Seine"                               
[141] "nerp:TASEffort_Trolling"                            
[142] "nerp:csq_tw_20112014"                               
[143] "nerp:csq_tr_20112014"                               
[144] "nerp:tr_2013070120180631"                           
[145] "nerp:tl_2013070120180631"                           
[146] "nerp:csq_tl_20112014"                               
[147] "nerp:vesseldensity2013_broadscale"                  
[148] "nerp:vesseldensity2013_finescale"                   
[149] "nerp:vesseldensity2014_broadscale"                  
[150] "nerp:vesseldensity2014_finescale"                   
[151] "nerp:vesseldensity2015_broadscale"                  
[152] "nerp:vesseldensity2015_finescale"                   
[153] "nerp:ez_broadscale"                                 
[154] "nerp:ez_finescale"                                  
[155] "nerp:humpback_westcoast"                            
[156] "nerp:national_aquaculture"                          
[157] "nerp:nsw_state_fisheries_20112015_gn_mn"            
[158] "nerp:nsw_state_fisheries_20112015_hg"               
[159] "nerp:nsw_state_fisheries_20112015_hl"               
[160] "nerp:nsw_state_fisheries_20112015_ll_dl"            
[161] "nerp:nsw_state_fisheries_20112015_seine_setnet"     
[162] "nerp:nsw_state_fisheries_20112015_seine_shots"      
[163] "nerp:nsw_state_fisheries_20112015_trap_pot"         
[164] "nerp:nsw_state_fisheries_20112015_tw_ds"            
[165] "nerp:nt_state_fisheries_aquarium_display_a12"       
[166] "nerp:nt_state_fisheries_bait_net_a3"                
[167] "nerp:nt_state_fisheries_barramundi_a7"              
[168] "nerp:nt_state_fisheries_coastal_line_a1"            
[169] "nerp:nt_state_fisheries_coastal_net_a2"             
[170] "nerp:nt_state_fisheries_demersal_a6"                
[171] "nerp:nt_state_fisheries_finfish_trawl_a16"          
[172] "nerp:nt_state_fisheries_jigging_fishery_licence_a17"
[173] "nerp:nt_state_fisheries_mud_crad_a8"                
[174] "nerp:nt_state_fisheries_offshore_net_and_line_a5"   
[175] "nerp:nt_state_fisheries_restricted_bait_a15"        
[176] "nerp:nt_state_fisheries_spanish_mackerel_a4"        
[177] "nerp:nt_state_fisheries_timor_reef_a18"             
[178] "nerp:nt_state_fisheries_trepang_a13"                
[179] "nerp:nt_state_fisheriesmollusc_a9"                  
[180] "nerp:qldeffort_harvest2011"                         
[181] "nerp:qldeffort_line2011"                            
[182] "nerp:qldeffort_net2011"                             
[183] "nerp:qldeffort_pot2011"                             
[184] "nerp:qldeffort_trawl2011"                           
[185] "nerp:recboat_v1"                                    
[186] "nerp:recboat_v2"                                    
[187] "nerp:recboat_v3"                                    
[188] "nerp:recboat_v4"                                    
[189] "nerp:recboat_v5"                                    
[190] "nerp:viceffort2011_bs_hl"                           
[191] "nerp:viceffort2011_bs_lldl"                         
[192] "nerp:viceffort2011_bs_mn"                           
[193] "nerp:viceffort2011_bs_twds"                         
[194] "nerp:viceffort2011_ppwp_lldl"                       
[195] "nerp:viceffort2011_ppwp_mn"                         
[196] "nerp:viceffort2011_ppwp_purseseine"                 
[197] "nerp:viceffort2011_ppwp_seinenet"                   
[198] "nerp:viceffort2011_rl_trappot"                      
[199] "nerp:wa_state_fisheries_20112015_gillnet"           
[200] "nerp:wa_state_fisheries_20112015_line"              
[201] "nerp:wa_state_fisheries_20112015_ll_dl"             
[202] "nerp:wa_state_fisheries_20112015_seine_and_haul_net"
[203] "nerp:wa_state_fisheries_20112015_trap_and_pot"      
[204] "nerp:wa_state_fisheries_20112015_trawl_"            </code></pre>
</div>
</div>
<p>As you can see, there are actually far more data available than just the shipping summary we were originally looking for! There are over 200 different spatial layers available here, making this a very fruitful endeavour (something we can not always admit to when spending time solving an R problem…).</p>
<p>Now we’ll get to the important part, getting this layer into an oh-so-familiar-and-comforting-and-versatile ‘sf’ object.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb10"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb10-1"><a href="#cb10-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Extract as sf</span></span>
<span id="cb10-2"><a href="#cb10-2" aria-hidden="true" tabindex="-1"></a>url<span class="sc">$</span>query <span class="ot">&lt;-</span> <span class="fu">list</span>(<span class="at">service =</span> <span class="st">'wfs'</span>,</span>
<span id="cb10-3"><a href="#cb10-3" aria-hidden="true" tabindex="-1"></a>                  <span class="co"># version = '2.0.0', # optional</span></span>
<span id="cb10-4"><a href="#cb10-4" aria-hidden="true" tabindex="-1"></a>                  <span class="at">request =</span> <span class="st">'GetFeature'</span>,</span>
<span id="cb10-5"><a href="#cb10-5" aria-hidden="true" tabindex="-1"></a>                  <span class="co"># Change typename to layer name</span></span>
<span id="cb10-6"><a href="#cb10-6" aria-hidden="true" tabindex="-1"></a>                  <span class="at">typename =</span> <span class="st">'nerp:ausrep_shipping_1999'</span>,</span>
<span id="cb10-7"><a href="#cb10-7" aria-hidden="true" tabindex="-1"></a>                  <span class="at">srsName =</span> <span class="st">'EPSG:4326'</span>)</span>
<span id="cb10-8"><a href="#cb10-8" aria-hidden="true" tabindex="-1"></a>layer_url <span class="ot">&lt;-</span> <span class="fu">build_url</span>(url)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Some notes on this code:</p>
<ul>
<li><p>‘version’ is an optional argument and allows us to specify the server version we want R to talk to.</p></li>
<li><p>‘typename’ refers to the data layer you are wanting to extract. We can change this to any of those listed from the output of the code we ran to get the names of all data layers. Doing so will extract that layer from the server.</p></li>
<li><p>‘srsName’ is where we state the coordinate reference system we want our data projected to. If this does not make sense, there are some other great blogs on the Geospatial website to help with this!</p></li>
<li><p>‘build_url’ is doing just that; building a URL for our request.</p></li>
</ul>
<p>Lets turn this into our ‘sf’ object!</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb11"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb11-1"><a href="#cb11-1" aria-hidden="true" tabindex="-1"></a>layer_sf <span class="ot">&lt;-</span> <span class="fu">read_sf</span>(layer_url)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>And that’s it! We now have our data layer into a format that allows us to tidy, wrangle, and analyse to our hearts content.</p>
<p>We have the all important data now, but that is really only scratching the surface with what we can do with this ‘url_client’ object. Going into more detail is beyond the scope of this blog but I encourage people who want to learn more to go onto the tutorial and Github page of that tutorials author (links are repeated below).</p>
<p><a href="https://inbo.github.io/tutorials/tutorials/spatial_wfs_services/"><strong>Tutorial</strong></a></p>
<p><a href="https://inbo.github.io/tutorials/authors/thierryo/"><strong>Github page</strong></a></p>
<p>Just to give you a taste of the other operations available, here are some example functions. First, we can access the meta data (if available on the server).</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb12"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb12-1"><a href="#cb12-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Get meta data</span></span>
<span id="cb12-2"><a href="#cb12-2" aria-hidden="true" tabindex="-1"></a>url_client<span class="sc">$</span></span>
<span id="cb12-3"><a href="#cb12-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">getCapabilities</span>()<span class="sc">$</span></span>
<span id="cb12-4"><a href="#cb12-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">getOperationsMetadata</span>()<span class="sc">$</span></span>
<span id="cb12-5"><a href="#cb12-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">getOperations</span>() <span class="sc">%&gt;%</span></span>
<span id="cb12-6"><a href="#cb12-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">map</span>(<span class="cf">function</span>(x){x<span class="sc">$</span><span class="fu">getParameters</span>()})</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[[1]]
[[1]]$AcceptVersions
[1] "1.0.0" "1.1.0" "2.0.0"

[[1]]$AcceptFormats
[1] "text/xml"

[[1]]$Sections
[1] "ServiceIdentification" "ServiceProvider"       "OperationsMetadata"   
[4] "FeatureTypeList"       "Filter_Capabilities"  


[[2]]
[[2]]$outputFormat
[1] "application/gml+xml; version=3.2"


[[3]]
[[3]]$resultType
[1] "results" "hits"   

[[3]]$outputFormat
 [1] "application/gml+xml; version=3.2"    
 [2] "GML2"                                
 [3] "KML"                                 
 [4] "SHAPE-ZIP"                           
 [5] "application/json"                    
 [6] "application/vnd.google-earth.kml xml"
 [7] "application/vnd.google-earth.kml+xml"
 [8] "csv"                                 
 [9] "gml3"                                
[10] "gml32"                               
[11] "json"                                
[12] "text/csv"                            
[13] "text/xml; subtype=gml/2.1.2"         
[14] "text/xml; subtype=gml/3.1.1"         
[15] "text/xml; subtype=gml/3.2"           

[[3]]$resolve
[1] "none"  "local"


[[4]]
[[4]]$resolve
[1] "none"  "local"

[[4]]$outputFormat
[1] "application/gml+xml; version=3.2"


[[5]]
named list()

[[6]]
named list()

[[7]]
[[7]]$language
[1] "urn:ogc:def:queryLanguage:OGC-WFS::WFSQueryExpression"


[[8]]
named list()

[[9]]
[[9]]$releaseAction
[1] "ALL"  "SOME"


[[10]]
[[10]]$resultType
[1] "results" "hits"   

[[10]]$outputFormat
 [1] "application/gml+xml; version=3.2"    
 [2] "GML2"                                
 [3] "KML"                                 
 [4] "SHAPE-ZIP"                           
 [5] "application/json"                    
 [6] "application/vnd.google-earth.kml xml"
 [7] "application/vnd.google-earth.kml+xml"
 [8] "csv"                                 
 [9] "gml3"                                
[10] "gml32"                               
[11] "json"                                
[12] "text/csv"                            
[13] "text/xml; subtype=gml/2.1.2"         
[14] "text/xml; subtype=gml/3.1.1"         
[15] "text/xml; subtype=gml/3.2"           

[[10]]$resolve
[1] "none"  "local"


[[11]]
[[11]]$inputFormat
[1] "application/gml+xml; version=3.2"

[[11]]$releaseAction
[1] "ALL"  "SOME"</code></pre>
</div>
</div>
<p>We can also use the ‘pluck’ function from the ‘purrr’ package to extract an element hidden deep within a nested object. Here, we are extracting the available output formats for the data layers.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb14"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb14-1"><a href="#cb14-1" aria-hidden="true" tabindex="-1"></a><span class="co"># See output formats</span></span>
<span id="cb14-2"><a href="#cb14-2" aria-hidden="true" tabindex="-1"></a>url_client<span class="sc">$</span></span>
<span id="cb14-3"><a href="#cb14-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">getCapabilities</span>()<span class="sc">$</span></span>
<span id="cb14-4"><a href="#cb14-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">getOperationsMetadata</span>()<span class="sc">$</span></span>
<span id="cb14-5"><a href="#cb14-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">getOperations</span>() <span class="sc">%&gt;%</span></span>
<span id="cb14-6"><a href="#cb14-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">map</span>(<span class="cf">function</span>(x){x<span class="sc">$</span><span class="fu">getParameters</span>()}) <span class="sc">%&gt;%</span></span>
<span id="cb14-7"><a href="#cb14-7" aria-hidden="true" tabindex="-1"></a>  <span class="co"># '3' is an index into the object</span></span>
<span id="cb14-8"><a href="#cb14-8" aria-hidden="true" tabindex="-1"></a>  <span class="fu">pluck</span>(<span class="dv">3</span>, <span class="st">'outputFormat'</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code> [1] "application/gml+xml; version=3.2"    
 [2] "GML2"                                
 [3] "KML"                                 
 [4] "SHAPE-ZIP"                           
 [5] "application/json"                    
 [6] "application/vnd.google-earth.kml xml"
 [7] "application/vnd.google-earth.kml+xml"
 [8] "csv"                                 
 [9] "gml3"                                
[10] "gml32"                               
[11] "json"                                
[12] "text/csv"                            
[13] "text/xml; subtype=gml/2.1.2"         
[14] "text/xml; subtype=gml/3.1.1"         
[15] "text/xml; subtype=gml/3.2"           </code></pre>
</div>
</div>
<p>As you can see, you can export the data in a different format if you are wanting it as something other than an ‘sf’ object or shapefile. We can also turn it into an Excel friendly .csv file.</p>
<p>So that brings us to the end of our brief look into WMS and WFS data and how we can access the data (and much more) using R. Hopefully, you have learned something useful.</p>
<p>Happy data hunting!</p>


</section>

</main> <!-- /main -->
<script id="quarto-html-after-body" type="application/javascript">
window.document.addEventListener("DOMContentLoaded", function (event) {
  const toggleBodyColorMode = (bsSheetEl) => {
    const mode = bsSheetEl.getAttribute("data-mode");
    const bodyEl = window.document.querySelector("body");
    if (mode === "dark") {
      bodyEl.classList.add("quarto-dark");
      bodyEl.classList.remove("quarto-light");
    } else {
      bodyEl.classList.add("quarto-light");
      bodyEl.classList.remove("quarto-dark");
    }
  }
  const toggleBodyColorPrimary = () => {
    const bsSheetEl = window.document.querySelector("link#quarto-bootstrap");
    if (bsSheetEl) {
      toggleBodyColorMode(bsSheetEl);
    }
  }
  toggleBodyColorPrimary();  
  const disableStylesheet = (stylesheets) => {
    for (let i=0; i < stylesheets.length; i++) {
      const stylesheet = stylesheets[i];
      stylesheet.rel = 'prefetch';
    }
  }
  const enableStylesheet = (stylesheets) => {
    for (let i=0; i < stylesheets.length; i++) {
      const stylesheet = stylesheets[i];
      stylesheet.rel = 'stylesheet';
    }
  }
  const manageTransitions = (selector, allowTransitions) => {
    const els = window.document.querySelectorAll(selector);
    for (let i=0; i < els.length; i++) {
      const el = els[i];
      if (allowTransitions) {
        el.classList.remove('notransition');
      } else {
        el.classList.add('notransition');
      }
    }
  }
  const toggleColorMode = (alternate) => {
    // Switch the stylesheets
    const alternateStylesheets = window.document.querySelectorAll('link.quarto-color-scheme.quarto-color-alternate');
    manageTransitions('#quarto-margin-sidebar .nav-link', false);
    if (alternate) {
      enableStylesheet(alternateStylesheets);
      for (const sheetNode of alternateStylesheets) {
        if (sheetNode.id === "quarto-bootstrap") {
          toggleBodyColorMode(sheetNode);
        }
      }
    } else {
      disableStylesheet(alternateStylesheets);
      toggleBodyColorPrimary();
    }
    manageTransitions('#quarto-margin-sidebar .nav-link', true);
    // Switch the toggles
    const toggles = window.document.querySelectorAll('.quarto-color-scheme-toggle');
    for (let i=0; i < toggles.length; i++) {
      const toggle = toggles[i];
      if (toggle) {
        if (alternate) {
          toggle.classList.add("alternate");     
        } else {
          toggle.classList.remove("alternate");
        }
      }
    }
    // Hack to workaround the fact that safari doesn't
    // properly recolor the scrollbar when toggling (#1455)
    if (navigator.userAgent.indexOf('Safari') > 0 && navigator.userAgent.indexOf('Chrome') == -1) {
      manageTransitions("body", false);
      window.scrollTo(0, 1);
      setTimeout(() => {
        window.scrollTo(0, 0);
        manageTransitions("body", true);
      }, 40);  
    }
  }
  const isFileUrl = () => { 
    return window.location.protocol === 'file:';
  }
  const hasAlternateSentinel = () => {  
    let styleSentinel = getColorSchemeSentinel();
    if (styleSentinel !== null) {
      return styleSentinel === "alternate";
    } else {
      return false;
    }
  }
  const setStyleSentinel = (alternate) => {
    const value = alternate ? "alternate" : "default";
    if (!isFileUrl()) {
      window.localStorage.setItem("quarto-color-scheme", value);
    } else {
      localAlternateSentinel = value;
    }
  }
  const getColorSchemeSentinel = () => {
    if (!isFileUrl()) {
      const storageValue = window.localStorage.getItem("quarto-color-scheme");
      return storageValue != null ? storageValue : localAlternateSentinel;
    } else {
      return localAlternateSentinel;
    }
  }
  let localAlternateSentinel = 'default';
  // Dark / light mode switch
  window.quartoToggleColorScheme = () => {
    // Read the current dark / light value 
    let toAlternate = !hasAlternateSentinel();
    toggleColorMode(toAlternate);
    setStyleSentinel(toAlternate);
  };
  // Ensure there is a toggle, if there isn't float one in the top right
  if (window.document.querySelector('.quarto-color-scheme-toggle') === null) {
    const a = window.document.createElement('a');
    a.classList.add('top-right');
    a.classList.add('quarto-color-scheme-toggle');
    a.href = "";
    a.onclick = function() { try { window.quartoToggleColorScheme(); } catch {} return false; };
    const i = window.document.createElement("i");
    i.classList.add('bi');
    a.appendChild(i);
    window.document.body.appendChild(a);
  }
  // Switch to dark mode if need be
  if (hasAlternateSentinel()) {
    toggleColorMode(true);
  } else {
    toggleColorMode(false);
  }
  const icon = "";
  const anchorJS = new window.AnchorJS();
  anchorJS.options = {
    placement: 'right',
    icon: icon
  };
  anchorJS.add('.anchored');
  const clipboard = new window.ClipboardJS('.code-copy-button', {
    target: function(trigger) {
      return trigger.previousElementSibling;
    }
  });
  clipboard.on('success', function(e) {
    // button target
    const button = e.trigger;
    // don't keep focus
    button.blur();
    // flash "checked"
    button.classList.add('code-copy-button-checked');
    var currentTitle = button.getAttribute("title");
    button.setAttribute("title", "Copied!");
    let tooltip;
    if (window.bootstrap) {
      button.setAttribute("data-bs-toggle", "tooltip");
      button.setAttribute("data-bs-placement", "left");
      button.setAttribute("data-bs-title", "Copied!");
      tooltip = new bootstrap.Tooltip(button, 
        { trigger: "manual", 
          customClass: "code-copy-button-tooltip",
          offset: [0, -8]});
      tooltip.show();    
    }
    setTimeout(function() {
      if (tooltip) {
        tooltip.hide();
        button.removeAttribute("data-bs-title");
        button.removeAttribute("data-bs-toggle");
        button.removeAttribute("data-bs-placement");
      }
      button.setAttribute("title", currentTitle);
      button.classList.remove('code-copy-button-checked');
    }, 1000);
    // clear code selection
    e.clearSelection();
  });
  function tippyHover(el, contentFn) {
    const config = {
      allowHTML: true,
      content: contentFn,
      maxWidth: 500,
      delay: 100,
      arrow: false,
      appendTo: function(el) {
          return el.parentElement;
      },
      interactive: true,
      interactiveBorder: 10,
      theme: 'quarto',
      placement: 'bottom-start'
    };
    window.tippy(el, config); 
  }
  const noterefs = window.document.querySelectorAll('a[role="doc-noteref"]');
  for (var i=0; i<noterefs.length; i++) {
    const ref = noterefs[i];
    tippyHover(ref, function() {
      // use id or data attribute instead here
      let href = ref.getAttribute('data-footnote-href') || ref.getAttribute('href');
      try { href = new URL(href).hash; } catch {}
      const id = href.replace(/^#\/?/, "");
      const note = window.document.getElementById(id);
      return note.innerHTML;
    });
  }
  const findCites = (el) => {
    const parentEl = el.parentElement;
    if (parentEl) {
      const cites = parentEl.dataset.cites;
      if (cites) {
        return {
          el,
          cites: cites.split(' ')
        };
      } else {
        return findCites(el.parentElement)
      }
    } else {
      return undefined;
    }
  };
  var bibliorefs = window.document.querySelectorAll('a[role="doc-biblioref"]');
  for (var i=0; i<bibliorefs.length; i++) {
    const ref = bibliorefs[i];
    const citeInfo = findCites(ref);
    if (citeInfo) {
      tippyHover(citeInfo.el, function() {
        var popup = window.document.createElement('div');
        citeInfo.cites.forEach(function(cite) {
          var citeDiv = window.document.createElement('div');
          citeDiv.classList.add('hanging-indent');
          citeDiv.classList.add('csl-entry');
          var biblioDiv = window.document.getElementById('ref-' + cite);
          if (biblioDiv) {
            citeDiv.innerHTML = biblioDiv.innerHTML;
          }
          popup.appendChild(citeDiv);
        });
        return popup.innerHTML;
      });
    }
  }
});
</script>
</div> <!-- /content -->



</body></html>